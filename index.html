<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam Hall Seating Plan with CSV Download</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    label, input, textarea, button {
      display: block;
      margin: 10px 0;
    }
    .grid {
      margin-top: 20px;
      display: grid;
      gap: 10px;
      background-color: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .seat {
      background-color: #e0ffe0;
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }
    textarea#csvOutput {
      width: 100%;
      margin-top: 20px;
      font-family: monospace;
      white-space: pre;
    }
  </style>
</head>
<body>

<h2>Exam Hall Seating Plan</h2>

<form id="seatingForm">
  <label for="rows">Number of Rows:</label>
  <input type="number" id="rows" required min="1">

  <label for="cols">Number of Columns:</label>
  <input type="number" id="cols" required min="1">

  <label for="students">
    Student Names or IDs (one per line):<br>
    Use <code>--</code> for a blank seat<br>
    Use <code>---</code> to start a new column and restart snaking
  </label>
  <textarea id="students" rows="12" cols="50" required></textarea>

  <button type="submit">Generate Seating Plan</button>
</form>

<div id="seatingGrid" class="grid"></div>

<h3>CSV Output (Spaced for Excel)</h3>
<textarea id="csvOutput" rows="12" readonly></textarea>
<button id="downloadBtn">Download CSV</button>

<script>
  let lastCSV = ''; // stores current CSV data

  function getRowLabel(index) {
    return String.fromCharCode(65 + index); // A, B, C...
  }

  document.getElementById('seatingForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const rows = parseInt(document.getElementById('rows').value);
    const cols = parseInt(document.getElementById('cols').value);
    const lines = document.getElementById('students').value.trim().split('\n').map(l => l.trim()).filter(l => l);

    const gridData = Array.from({ length: rows }, () => Array(cols).fill(""));

    let col = 0;
    let direction = true; // true = down, false = up
    let rowOrder = [...Array(rows).keys()];
    let rIdx = 0;

    for (let i = 0; i < lines.length; i++) {
      const entry = lines[i];

      if (entry === "---") {
        col++;
        if (col >= cols) break;
        direction = true;
        rowOrder = [...Array(rows).keys()];
        rIdx = 0;
        continue;
      }

      const studentName = entry === "--" ? "" : entry;

      if (rIdx >= rows) {
        col++;
        if (col >= cols) break;
        direction = !direction;
        rowOrder = direction ? [...Array(rows).keys()] : [...Array(rows).keys()].reverse();
        rIdx = 0;
      }

      const row = rowOrder[rIdx];
      gridData[row][col] = studentName;
      rIdx++;
    }

    // Render seating grid
    const grid = document.getElementById('seatingGrid');
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(${cols + 1}, auto)`;

    grid.appendChild(document.createElement('div'));
    for (let c = 0; c < cols; c++) {
      const label = document.createElement('div');
      label.className = 'seat';
      label.style.backgroundColor = '#d0d0ff';
      label.textContent = c + 1;
      grid.appendChild(label);
    }

    for (let r = 0; r < rows; r++) {
      const rowLabel = document.createElement('div');
      rowLabel.className = 'seat';
      rowLabel.style.backgroundColor = '#d0d0ff';
      rowLabel.textContent = getRowLabel(r);
      grid.appendChild(rowLabel);

      for (let c = 0; c < cols; c++) {
        const seat = document.createElement('div');
        seat.className = 'seat';
        seat.textContent = gridData[r][c];
        grid.appendChild(seat);
      }
    }

    // Generate CSV with spacing
    const csvRows = [];
    const header = [""];
    for (let c = 0; c < cols; c++) {
      header.push(c + 1);
      if (c !== cols - 1) header.push("");
    }
    csvRows.push(header.join(","));

    for (let r = 0; r < rows; r++) {
      const row = [getRowLabel(r)];
      for (let c = 0; c < cols; c++) {
        row.push(gridData[r][c]);
        if (c !== cols - 1) row.push("");
      }
      csvRows.push(row.join(","));
      if (r !== rows - 1) csvRows.push("");
    }

    lastCSV = csvRows.join("\n");
    document.getElementById('csvOutput').value = lastCSV;
  });

  document.getElementById('downloadBtn').addEventListener('click', function () {
    if (!lastCSV) {
      alert("Please generate the seating plan first.");
      return;
    }

    const blob = new Blob([lastCSV], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement("a");
    link.setAttribute("href", url);
    link.setAttribute("download", "seating_plan.csv");
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  });
</script>

</body>
</html>
