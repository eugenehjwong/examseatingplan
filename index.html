<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Exam Hall Seating Plan (Vertical Snake + Excel + Labels)</title>
  <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mini.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 40px;
    }
    label, input, textarea, button {
      display: block;
      margin: 10px 0;
    }
    .grid {
      margin-top: 20px;
      display: grid;
      gap: 10px;
      background-color: #f0f0f0;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .seat {
      background-color: #e0ffe0;
      border: 1px solid #aaa;
      padding: 8px;
      text-align: center;
      font-size: 14px;
    }
  </style>
</head>
<body>

<h2>Exam Hall Seating Plan (Vertical Snake Pattern with Labels)</h2>

<form id="seatingForm">
  <label for="rows">Number of Rows:</label>
  <input type="number" id="rows" required min="1">

  <label for="cols">Number of Columns:</label>
  <input type="number" id="cols" required min="1">

  <label for="students">Student Names or IDs (one per line, in register order):</label>
  <textarea id="students" rows="10" cols="40" required></textarea>

  <button type="submit">Generate Seating Plan</button>
</form>

<button id="exportBtn" style="display:none;">üìÅ Download as Excel</button>

<div id="seatingGrid" class="grid"></div>

<script>
  let lastGridData = [];

  function getRowLabel(index) {
    return String.fromCharCode(65 + index); // A, B, C, ...
  }

  document.getElementById('seatingForm').addEventListener('submit', function (e) {
    e.preventDefault();

    const rows = parseInt(document.getElementById('rows').value);
    const cols = parseInt(document.getElementById('cols').value);
    const studentsRaw = document.getElementById('students').value.trim();
    const studentList = studentsRaw.split('\n').map(s => s.trim()).filter(s => s);

    // 2D array with seat data
    const gridData = Array.from({ length: rows }, () => Array(cols).fill(null));
    let studentIndex = 0;

    for (let col = 0; col < cols; col++) {
      const directionDown = col % 2 === 0;
      const rowRange = directionDown ? [...Array(rows).keys()] : [...Array(rows).keys()].reverse();

      for (let row of rowRange) {
        if (studentIndex < studentList.length) {
          gridData[row][col] = studentList[studentIndex];
          studentIndex++;
        } else {
          gridData[row][col] = "- Empty -";
        }
      }
    }

    // Save for Excel export with headers
    lastGridData = [["", ...Array.from({ length: cols }, (_, i) => (i + 1).toString())]];
    for (let r = 0; r < rows; r++) {
      lastGridData.push([getRowLabel(r), ...gridData[r]]);
    }

    // Render grid to screen
    const grid = document.getElementById('seatingGrid');
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(${cols + 1}, auto)`;

    // Render header row
    const blank = document.createElement('div');
    blank.className = 'seat';
    blank.textContent = '';
    grid.appendChild(blank);

    for (let c = 0; c < cols; c++) {
      const label = document.createElement('div');
      label.className = 'seat';
      label.style.backgroundColor = '#d0d0ff';
      label.textContent = c + 1;
      grid.appendChild(label);
    }

    // Render each row with row label and data
    for (let r = 0; r < rows; r++) {
      const rowLabel = document.createElement('div');
      rowLabel.className = 'seat';
      rowLabel.style.backgroundColor = '#d0d0ff';
      rowLabel.textContent = getRowLabel(r);
      grid.appendChild(rowLabel);

      for (let c = 0; c < cols; c++) {
        const seat = document.createElement('div');
        seat.className = 'seat';
        seat.textContent = gridData[r][c];
        grid.appendChild(seat);
      }
    }

    document.getElementById('exportBtn').style.display = 'block';
  });

  document.getElementById('exportBtn').addEventListener('click', function () {
    const ws = XLSX.utils.aoa_to_sheet(lastGridData);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "SeatingPlan");
    XLSX.writeFile(wb, "ExamHallSeatingPlan.xlsx");
  });
</script>

</body>
</html>
